<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Teams Admin â€“ Pool League Bali</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family:"Segoe UI", Arial, sans-serif; background:#111; color:#eee; margin:0; padding:0; }
    nav { background:#222; padding:10px; text-align:center; }
    nav a { color:#ffd700; margin:0 15px; text-decoration:none; font-weight:bold; }
    nav a:hover { text-decoration:underline; }
    h1 { text-align:center; color:#ffd700; text-transform:uppercase; letter-spacing:2px; margin:20px 0; }
    .hidden { display:none; }
    input, button { padding:6px; margin:3px; border:none; border-radius:4px; font-size:13px; }
    button { background:#444; color:#ffd700; cursor:pointer; }
    button:hover { background:#666; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin:20px; }
    .team-actions { text-align:center; margin:20px 0; }
  </style>
</head>
<body>
  <!-- Navigatie -->
  <nav>
    <a href="index.html">Home</a>
    <a href="standings.html">Standings</a>
    <a href="teams.html">Teams</a>
    <a href="schedule.html">Schedule</a>
    <a href="results.html">Results</a>
    <a href="teams-admin.html">Admin</a>
  </nav>

  <h1>Teams Admin</h1>

  <!-- Login -->
  <div id="loginSection" style="text-align:center;">
    <input id="accessCode" placeholder="Enter access code">
    <button onclick="checkAccess()">Login</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="hidden">
    <div class="team-actions">
      <input id="newTeamName" placeholder="Nieuwe teamnaam">
      <button onclick="addTeam()">Add Team</button>
      <button onclick="deleteTeam()">Delete Team</button>
    </div>

    <div id="teamsContainer" class="grid"></div>
  </div>
  <script>
    // Login check
    function checkAccess() {
      const code = document.getElementById("accessCode").value;
      if (code === "DJ88888") {
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
        loadTeams();
      } else {
        alert("Ongeldige toegangscode");
      }
    }

    // Teams laden uit JSON
    async function loadTeams() {
      const res = await fetch("teams-data.json");
      const data = await res.json();
      renderTeams(data);
    }

    // Teams renderen in grid
    function renderTeams(data) {
      const container = document.getElementById("teamsContainer");
      container.innerHTML = "";
      data.forEach(team => {
        const table = document.createElement("table");
        let rows = "";
        team.players.forEach(p => {
          rows += `<tr><td>${p.name}${p.captain ? " (C)" : ""}</td><td>${p.handicap}</td><td>
            <button onclick="editPlayer('${team.team}','${p.name}')">Edit</button>
            <button onclick="deletePlayer('${team.team}','${p.name}')">Delete</button>
          </td></tr>`;
        });
        // extra rij voor nieuwe speler
        rows += `
          <tr class="action-row">
            <td><input id="player-${team.team}" placeholder="Speler naam"></td>
            <td><input id="handicap-${team.team}" placeholder="Handicap"></td>
            <td><button onclick="addPlayer('${team.team}')">Add Player</button></td>
          </tr>
        `;
        table.innerHTML = `
          <thead>
            <tr><th colspan="3">${team.team}</th></tr>
            <tr><th>Speler</th><th>Handicap</th><th>Acties</th></tr>
          </thead>
          <tbody>${rows}</tbody>`;
        container.appendChild(table);
      });
    }

    // Teambeheer
    async function addTeam() {
      const team = document.getElementById("newTeamName").value.trim();
      if (!team) return alert("Teamnaam verplicht");
      await triggerWorkflow({team});
    }
    async function deleteTeam() {
      const team = document.getElementById("newTeamName").value.trim();
      if (!team) return alert("Teamnaam verplicht");
      await triggerWorkflow({team, action:"delete"});
    }

    // Playerbeheer
    async function addPlayer(team) {
      const player = document.getElementById("player-"+team).value.trim();
      const handicap = document.getElementById("handicap-"+team).value.trim() || "0";
      if (!player) return alert("Spelernaam verplicht");
      await triggerWorkflow({team, player, handicap, action:"add"});
    }
    async function editPlayer(team, player) {
      const handicap = prompt("Nieuwe handicap voor "+player+":");
      if (handicap===null) return;
      await triggerWorkflow({team, player, handicap, action:"edit"});
    }
    async function deletePlayer(team, player) {
      if (!confirm("Verwijder speler "+player+" uit "+team+"?")) return;
      await triggerWorkflow({team, player, action:"delete"});
    }

    // Workflow trigger
    async function triggerWorkflow(payload) {
      await fetch("https://api.github.com/repos/djsopamena1965-182120/Pool-League-Bali/actions/workflows/update-teams.yml/dispatches", {
        method: "POST",
        headers: { "Accept": "application/vnd.github+json" },
        body: JSON.stringify({ ref: "main", inputs: payload })
      });
      alert("Workflow gestart, even wachten...");
      setTimeout(loadTeams, 5000);
    }
  </script>
</body>
</html>
