<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Teams Admin â€“ Pool League Bali</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #0f0f0f;
      color: #eaeaea;
      margin: 0;
      padding: 0;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 24px;
      padding: 12px 20px;
      margin: 0;
      background: #1a1a1a;
      border-bottom: 1px solid #333;
    }
    nav a {
      color: #ccc;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease;
    }
    nav a:hover {
      color: #ffd700;
    }

    h1 {
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #ffd700;
      margin: 30px 0;
      font-size: 24px;
    }

    #loginBox {
      text-align: center;
      margin-top: 60px;
    }
    #loginBox input {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #1a1a1a;
      color: #eee;
      font-size: 14px;
    }
    #loginBox button {
      padding: 10px 20px;
      margin-left: 10px;
      background: #444;
      color: #eee;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background 0.2s ease;
    }
    #loginBox button:hover {
      background: #666;
    }

    #adminContent {
      display: none;
    }

    form {
      margin: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    form input {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #1a1a1a;
      color: #eee;
      font-size: 14px;
    }
    form button {
      padding: 10px 20px;
      background: #444;
      color: #eee;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }
    form button:hover {
      background: #666;
    }

    #teamsContainer {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin: 20px;
    }
    @media (max-width: 768px) {
      #teamsContainer { grid-template-columns: 1fr; }
    }

    .team-block {
      background: #1a1a1a;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .team-block:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.7);
    }

    .team-block table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      background: #181818;
    }
    .team-block thead th {
      background: #222;
      color: #ffd700;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 12px;
      font-weight: 600;
      border-bottom: 1px solid #333;
    }
    .team-block tbody td {
      padding: 10px;
      border-top: 1px solid #333;
      text-align: center;
      color: #ddd;
    }
    .team-block tbody tr:nth-child(even) {
      background: #202020;
    }
    .team-block tbody tr:hover {
      background: #2a2a2a;
    }
    .team-block tfoot td {
      padding: 12px;
      background: #1a1a1a;
      border-top: 1px solid #333;
      text-align: center;
    }

    /* Compact buttons */
    .team-block button {
      padding: 4px 8px;
      margin: 2px;
      background: #444;
      color: #eee;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      display: inline-block;
      transition: background 0.2s ease;
    }
    .team-block button:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <nav class="main-nav">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="teams.html">Teams</a></li>
      <li><a href="match-results.html">Match Results</a></li>
      <li><a href="standings.html">Standings</a></li>
      <li><a href="rules.html">Rules</a></li>
      <li><a href="other-events.html">Other Competitions</a></li>
      <li><a href="teams-admin.html" aria-current="page">Admin</a></li>
    </ul>
  </nav>

  <h1>Teams Admin</h1>

  <div id="loginBox">
    <h2 style="color:#ffd700;">Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="checkLogin()">Login</button>
  </div>

  <div id="adminContent">
    <form id="addTeamForm">
      <input type="text" id="teamName" placeholder="Team name" required>
      <input type="text" id="playerName" placeholder="Player name">
      <input type="text" id="handicap" placeholder="Handicap">
      <button type="submit">Add</button>
    </form>
    <div id="teamsContainer"></div>
  </div>
  <script>
    // Vul hier jouw persoonlijke GitHub token in
   const token = "github_pat_11B3ALJA40X5z2f5esZDtI_RkHeFC8FPcEYVnfABUT60gJdXRp4RbVKvGuY2NY2inxV2HQL5HD5Mms";
    const repoOwner = "djsopamena1965-182120";
    const repoName = "Pool-League-Bali";
    const filePath = "teams-data.json";
    const accessCode = "DJ88888"; // jouw geheime login code

    function checkLogin() {
      const input = document.getElementById("adminPass").value;
      if (input === accessCode) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminContent").style.display = "block";
        loadTeams();
      } else {
        alert("Access denied");
        window.location.href = "teams.html";
      }
    }

    async function getFileSha() {
      const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await response.json();
      return data.sha;
    }

    async function updateFile(newContent) {
      const sha = await getFileSha();
      await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
        method: "PUT",
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Update teams-data.json via admin",
          content: btoa(unescape(encodeURIComponent(newContent))),
          sha: sha
        })
      });
    }

    async function loadTeams() {
      const response = await fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${filePath}`);
      const data = await response.json();
      const container = document.getElementById("teamsContainer");
      container.innerHTML = "";

      data.forEach((team, teamIndex) => {
        const block = document.createElement("div");
        block.className = "team-block";

        let rows = "";
        team.players.forEach((p, playerIndex) => {
          rows += `
            <tr>
              <td>${p.name}</td>
              <td>${p.handicap}</td>
              <td>
                <button onclick="editPlayer(${teamIndex},${playerIndex})">Edit</button>
                <button onclick="editHandicap(${teamIndex},${playerIndex})">Handicap</button>
                <button onclick="deletePlayer(${teamIndex},${playerIndex})">Delete</button>
              </td>
            </tr>`;
        });

        if (rows === "") {
          rows = `<tr><td colspan="3">No players added yet</td></tr>`;
        }

        block.innerHTML = `
          <table>
            <thead>
              <tr>
                <th colspan="3">
                  ${team.team}
                  <button onclick="editTeam(${teamIndex})">Rename</button>
                  <button onclick="deleteTeam(${teamIndex})">Delete team</button>
                </th>
              </tr>
              <tr><th>Player</th><th>Handicap</th><th>Actions</th></tr>
            </thead>
            <tbody>${rows}</tbody>
            <tfoot>
              <tr>
                <td colspan="3">
                  <button onclick="addPlayer(${teamIndex})">Add player</button>
                </td>
              </tr>
            </tfoot>
          </table>`;
        container.appendChild(block);
      });

      // Bewaar data in memory voor CRUD functies
      window.teamsData = data;
    }

    // Form submit listener
    document.getElementById("addTeamForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const teamName = document.getElementById("teamName").value;
      const playerName = document.getElementById("playerName").value;
      const handicap = document.getElementById("handicap").value;

      let team = window.teamsData.find(t => t.team === teamName);
      if (!team) {
        team = { team: teamName, players: [] };
        window.teamsData.push(team);
      }
      if (playerName) {
        team.players.push({ name: playerName, handicap: handicap });
      }

      await updateFile(JSON.stringify(window.teamsData, null, 2));
      await loadTeams();
      e.target.reset();
      alert("Team/speler toegevoegd en teams-data.json bijgewerkt.");
    });

    // CRUD functies
    window.editTeam = async function(teamIndex) {
      const newName = prompt("New team name:", window.teamsData[teamIndex].team);
      if (newName) {
        window.teamsData[teamIndex].team = newName;
        await updateFile(JSON.stringify(window.teamsData, null, 2));
        await loadTeams();
      }
    };

    window.deleteTeam = async function(teamIndex) {
      if (confirm("Are you sure you want to delete this team?")) {
        window.teamsData.splice(teamIndex, 1);
        await updateFile(JSON.stringify(window.teamsData, null, 2));
        await loadTeams();
      }
    };

    window.addPlayer = async function(teamIndex) {
      const name = prompt("Player name:");
      const handicap = prompt("Handicap:");
      if (name) {
        window.teamsData[teamIndex].players.push({ name: name, handicap: handicap || "-" });
        await updateFile(JSON.stringify(window.teamsData, null, 2));
        await loadTeams();
      }
    };

    window.editPlayer = async function(teamIndex, playerIndex) {
      const player = window.teamsData[teamIndex].players[playerIndex];
      const newName = prompt("New name:", player.name);
      const newHandicap = prompt("New handicap:", player.handicap);
      if (newName !== null && newName.trim() !== "") {
        player.name = newName.trim();
      }
      if (newHandicap !== null && newHandicap.trim() !== "") {
        player.handicap = newHandicap.trim();
      }
      await updateFile(JSON.stringify(window.teamsData, null, 2));
      await loadTeams();
    };

    window.editHandicap = async function(teamIndex, playerIndex) {
      const player = window.teamsData[teamIndex].players[playerIndex];
      const newHandicap = prompt("New handicap:", player.handicap);
      if (newHandicap !== null && newHandicap.trim() !== "") {
        player.handicap = newHandicap.trim();
        await updateFile(JSON.stringify(window.teamsData, null, 2));
        await loadTeams();
      }
    };

    window.deletePlayer = async function(teamIndex, playerIndex) {
      if (confirm("Are you sure you want to delete this player?")) {
        window.teamsData[teamIndex].players.splice(playerIndex, 1);
        await updateFile(JSON.stringify(window.teamsData, null, 2));
        await loadTeams();
      }
    };
  </script>
</body>
</html>
